# Enhanced Exploitation Methodology
## Based on Jenkins CVE-2024-23897 Approach

This document outlines the enhanced exploitation methodology based on the Jenkins CVE-2024-23897 walkthrough, adapted for XWiki and Gitea.

## Methodology Overview

The Jenkins CVE-2024-23897 approach follows this pattern:
1. **File Read Vulnerability** → Read system files
2. **Hash Extraction** → Extract password hashes from configuration files
3. **Hash Cracking** → Crack hashes to get credentials
4. **Authenticated Access** → Login with cracked credentials
5. **Feature Abuse** → Use platform features (pipelines, hooks) for RCE
6. **Privilege Escalation** → Escalate to root/admin

## Applied to Your Systems

### System 1: Editor (XWiki 15.10.8)

**File Read Vectors:**
- XWiki REST API file access
- Template injection file inclusion
- Configuration file access

**Hash Extraction:**
- User configuration files: `/var/xwiki/users/`
- Database dumps (if accessible)
- Configuration XML files

**Authentication:**
- Default credentials: admin/admin, xwiki/xwiki
- Cracked password hashes

**RCE Methods:**
- Groovy template injection
- Velocity template injection
- Script console (if accessible)

**Steps:**
```bash
# 1. Run enhanced exploitation script
bash SCRIPTS/system1_editor_exploit_enhanced.sh

# 2. If credentials found, login and try template injection
# 3. Use script console if available
# 4. Create page with Groovy code for RCE
```

### System 4: Lock (Gitea 1.21.3)

**File Read Vectors:**
- Raw file access via API (requires repo)
- Configuration file access (if file read exists)
- Database access (if file read exists)

**Hash Extraction:**
- User database (if accessible)
- Configuration files
- Repository secrets

**Authentication:**
- Default credentials: admin/admin, gitea/gitea
- Repository credential mining
- Cracked password hashes

**RCE Methods:**
- Git hooks (post-receive, pre-receive)
- File upload via repository
- Gitea Actions (if available)

**Steps:**
```bash
# 1. Run enhanced exploitation script
bash SCRIPTS/system4_lock_exploit_enhanced.sh

# 2. If credentials found, login and create repository
# 3. Set up Git hooks for RCE
# 4. Push to trigger hook and get reverse shell
```

## Key Techniques from Jenkins Walkthrough

### 1. File Read via CLI/API
**Jenkins:** `java -jar jenkins-cli.jar help @/etc/passwd`

**XWiki Equivalent:**
- REST API file access
- Template file inclusion
- Configuration file reading

**Gitea Equivalent:**
- Raw file API: `/api/v1/repos/{owner}/{repo}/raw/{branch}/{filepath}`
- Requires repository access

### 2. Hash Extraction
**Jenkins:** Read `/var/jenkins_home/users/{user}/config.xml` for password hash

**XWiki Equivalent:**
- User configuration: `/var/xwiki/users/{user}/config.xml`
- Database user table (if accessible)

**Gitea Equivalent:**
- User database (if file read possible)
- Repository secrets
- Configuration files

### 3. Hash Cracking
**Jenkins:** `hashcat -m 3200 hash.txt rockyou.txt` (bcrypt)

**XWiki/Gitea:**
- Identify hash format (bcrypt, SHA, etc.)
- Use hashcat or john
- Common formats:
  - bcrypt: `hashcat -m 3200`
  - SHA256: `hashcat -m 1400`
  - SHA512: `hashcat -m 1700`

### 4. Feature Abuse for RCE
**Jenkins:** SSH Agent plugin in pipeline

**XWiki Equivalent:**
- Script console
- Groovy template injection
- Velocity template injection

**Gitea Equivalent:**
- Git hooks (post-receive, pre-receive)
- File upload and execution
- Gitea Actions (if available)

## Enhanced Scripts Created

1. **system1_editor_exploit_enhanced.sh**
   - File read attempts
   - Hash extraction
   - Hash cracking
   - Template injection RCE
   - Script console access

2. **system4_lock_exploit_enhanced.sh**
   - File read attempts
   - Hash extraction
   - Repository credential mining
   - Git hooks RCE
   - SSH key extraction

## Quick Start

### For XWiki (System 1):
```bash
cd ~/network-penteration-testing
bash SCRIPTS/system1_editor_exploit_enhanced.sh
```

### For Gitea (System 4):
```bash
cd ~/network-penteration-testing
bash SCRIPTS/system4_lock_exploit_enhanced.sh
```

## Important Notes

1. **File Read Limitations**: XWiki and Gitea may not have the same file read vulnerability as Jenkins CVE-2024-23897. The scripts attempt various methods.

2. **Authentication Required**: Most RCE methods require authentication. Focus on credential discovery first.

3. **Hash Formats**: Different systems use different hash formats. Identify the format before cracking.

4. **Feature Availability**: Not all features (script console, git hooks) may be available. Try multiple methods.

5. **Documentation**: Document all attempts, even failures. This shows thorough testing.

## References

- Jenkins CVE-2024-23897: https://www.jenkins.io/security/advisory/2024-01-24/
- XWiki Security: https://jira.xwiki.org/browse/XWIKI
- Gitea Security: https://github.com/go-gitea/gitea/security/advisories

